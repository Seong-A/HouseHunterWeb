<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HouseHunter</title>
    <link rel="stylesheet" href="/stylesheets/roomdetail.css">

    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=<%= naverMapAPIClientID %>"></script>
    <script>
        window.onload = function() {
            initMap(); // 맵 초기화

            // 좋아요 버튼 클릭 이벤트 리스너 추가
            var isLiked = false; // 좋아요 상태를 저장할 변수
            var likeButton = document.getElementById('like-button');

            likeButton.addEventListener('click', function() {
                if (isLiked) { // 이미 좋아요를 누른 상태라면
                    likeButton.style.backgroundImage = "url('/image/heart_empty.png')"; // 하트를 비어있는 상태로 변경
                } else { // 좋아요를 누르지 않은 상태라면
                    likeButton.style.backgroundImage = "url('/image/heart_filled.png')"; // 하트를 채워진 상태로 변경
                }
            
                isLiked = !isLiked; // 좋아요 상태를 반전
            });
            
            loadHeader(); // 헤더 로드
        };

        function loadHeader() {
            fetch('/header') 
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    document.querySelector('.login-button').addEventListener('click', function() {
                        checkLogin(); 
                    });
                    updateUI();
                })
                .catch(error => console.error('Error:', error));
        }
        
        async function checkLogin() {
            try {
                const response = await fetch('/check-login');
                const data = await response.json();

                if (data.isLoggedIn) {
                    window.location.href = '/mypage';
                } else {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function updateUI() {
            try {
                const response = await fetch('/check-login');
                const userData = await response.json();
                const userNameDisplay = document.querySelector('.user-name');

                if (userData.isLoggedIn) {
                    const loginButton = document.querySelector('.login-button');
                    loginButton.style.display = 'none'; 
                    userNameDisplay.textContent = userData.userName; 
                    userNameDisplay.style.display = 'inline-block';
                } else {
                    userNameDisplay.style.display = 'none'; 
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function initMap() {
            var mapOptions = {
                center: new naver.maps.LatLng(37.5665, 126.9780),
                zoom: 15
            };

            var map = new naver.maps.Map('map', mapOptions);
        }
    </script>
</head>
<body>
    <div id="header-container"></div>

    <main>
        <div class="content">
            <div class="image-gallery">
                <img id=photo1 alt="Image 1">
                <img id=photo2 alt="Image 2">
            </div>
        </div>

        <div class="room">
            <div class="room-container">
                <div class="room-title">
                    <h2 id="rtype">방유형</h2> 
                    <h2 id="fix_money"> 보증금</h2>
                    <h2 id="monthly_money">/월세</h2>
                </div>
                <div class="room-info">
                    <img src="image/type.png" alt="Room Type">
                    <p>방 종류 : </p>
                    &nbsp;&nbsp;
                    <p id="rtype">  type</p>
                </div>
                <div class="room-info">
                    <img src="image/size.png" alt="Room Size">
                    <p>방 사이즈 : </p>  
                    &nbsp;&nbsp;
                    <p id="size">  Size</p>
                </div>
                <div class="room-info">
                    <img src="image/elevator.png" alt="Elevator">
                    <p>엘리베이터  :</p>
                    &nbsp;&nbsp;
                    <p id="elevator">yes</p>
                </div>
                <div class="room-info">
                    <img src="image/money.png" alt="money">
                    <p>관리비 :</p>
                    &nbsp;&nbsp;
                    <p id="management_money">money</p>
                </div>
                <div class="room-info">
                    <button id="like-button" class="like-button"></button>
                    <div class="phone" id="phone">전화번호</div>
                </div>
            </div>
    
            <div class="detail-content">
                <div class="detail-container">
                    <div class="room-price">
                        <h2>가격정보</h2>
                    </div>
                    <div class="room-price">
                        <p>월세</p>
                        &nbsp;&nbsp;
                        <p2 id="monthly_money">0원</p2>
                    </div>
    
                    <div class="room-price">
                        <p>관리비</p>
                        &nbsp;&nbsp;
                        <p2 id="management_money">0원</p2>
                    </div>
    
                    <div class="room-price">
                        <p>주차가능여부</p>
                        &nbsp;&nbsp;
                        <p2 id="parking">가능</p2>
                    </div>
                </div>
                <div class="horizontal-line"></div>  
                <div class="detail-container">
                    <div class="room-price">
                        <h2>상세정보</h2>
                    </div>
                    <div class="room-price">
                        <p>방종류</p>
                        &nbsp;&nbsp;
                        <p2 id="rtype">00</p2>
                    </div>
    
                    <div class="room-price">
                        <p>해당층/건물층</p>
                        &nbsp;&nbsp;
                        <p2 id="floor">0층/0층</p2>
                    </div>
    
                    <div class="room-price">
                        <p>방 수/ 욕실 수</p>
                        &nbsp;&nbsp;
                        <p2 id="room_bath">0개/ 0개</p2>
                    </div>
                    <div class="room-price">
                        <p>앨레베이터</p>
                        &nbsp;&nbsp;
                        <p2 id="elevator">있음</p2>
                    </div>
                    <div class="room-price">
                        <p>총 세대 수</p>
                        &nbsp;&nbsp;
                        <p2 id="total_room">00세대</p2>
                    </div>
                    <div class="room-price">
                        <p>총 주차대수</p>
                        &nbsp;&nbsp;
                        <p2 id="total_parking">0개</p2>
                    </div>
                    <div class="room-price">
                        <p>입주가능일</p>
                        &nbsp;&nbsp;
                        <p2 id="date">즉시입주</p2>
                    </div>
                </div>
                <div class="horizontal-line"></div>  
            </div>
        </div>
        <div class="map-info">
            <h2>위치 정보</h2>
        </div>
        <div id="map" class="map"></div>      
    </main>
    <footer>
        <p>하우스헌터</p>
        <p>고객센터 02-111-2222</p>
    </footer>
</body>
</html>